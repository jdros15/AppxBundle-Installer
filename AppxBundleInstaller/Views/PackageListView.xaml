<UserControl x:Class="AppxBundleInstaller.Views.PackageListView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:ui="http://schemas.modernwpf.com/2019"
             Loaded="OnLoaded">
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <Grid Grid.Row="0" Margin="0,0,0,16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            
            <TextBlock Text="Installed Apps" Style="{StaticResource SectionHeaderStyle}" Margin="0" />
            
            <StackPanel Grid.Column="1" Orientation="Horizontal">
                <Button x:Name="ExportButton" Content="Export" Click="ExportButton_Click" Padding="16,8" Margin="0,0,8,0" />
                <Button x:Name="RefreshButton" Content="Refresh" Click="RefreshButton_Click" Padding="16,8" />
            </StackPanel>
        </Grid>
        
        <!-- Search Bar -->
        <Border Grid.Row="1" Style="{StaticResource CardStyle}" Margin="0,0,0,16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                
                <TextBox x:Name="SearchBox" 
                         ui:ControlHelper.PlaceholderText="Search packages..."
                         TextChanged="SearchBox_TextChanged"
                         Padding="8"
                         FontSize="14" />
                
                <ComboBox x:Name="PublisherFilter" 
                          Grid.Column="1"
                          SelectedIndex="0"
                          SelectionChanged="PublisherFilter_SelectionChanged"
                          MinWidth="120"
                          Margin="12,0,0,0">
                    <ComboBoxItem Content="All" />
                    <ComboBoxItem Content="Microsoft" />
                    <ComboBoxItem Content="Third-Party" />
                </ComboBox>
                
                <CheckBox x:Name="ShowFrameworks"
                          Grid.Column="2"
                          Content="Frameworks"
                          Checked="Filter_Changed"
                          Unchecked="Filter_Changed"
                          Margin="12,0,0,0"
                          VerticalAlignment="Center" />
            </Grid>
        </Border>
        
        <!-- Loading -->
        <StackPanel x:Name="LoadingPanel" 
                    Grid.Row="2" 
                    HorizontalAlignment="Center" 
                    VerticalAlignment="Center"
                    Visibility="Collapsed">
            <ui:ProgressRing IsActive="True" Width="40" Height="40" />
            <TextBlock Text="Loading packages..." Margin="0,12,0,0" 
                       Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
        </StackPanel>
        
        <!-- Package List -->
        <ListView x:Name="PackageList"
                  Grid.Row="2"
                  SelectionChanged="PackageList_SelectionChanged"
                  Background="Transparent"
                  BorderThickness="0">
            <ListView.ItemTemplate>
                <DataTemplate>
                    <Grid Margin="0,8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="44" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="120" />
                            <ColumnDefinition Width="70" />
                        </Grid.ColumnDefinitions>
                        
                        <!-- Icon -->
                        <Border Grid.Column="0" 
                                Width="36" Height="36"
                                Background="{DynamicResource SystemControlHighlightAccentBrush}"
                                CornerRadius="6">
                            <TextBlock Text="ðŸ“¦" FontSize="18" 
                                       HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                        
                        <!-- Name & Publisher -->
                        <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="8,0,0,0">
                            <TextBlock Text="{Binding DisplayName}" 
                                       FontWeight="SemiBold"
                                       TextTrimming="CharacterEllipsis"
                                       Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}" />
                            <TextBlock Text="{Binding PublisherDisplayName}" 
                                       FontSize="12"
                                       TextTrimming="CharacterEllipsis"
                                       Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
                        </StackPanel>
                        
                        <!-- Version -->
                        <TextBlock Grid.Column="2" 
                                   Text="{Binding Version}"
                                   VerticalAlignment="Center"
                                   Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
                        
                        <!-- Arch -->
                        <TextBlock Grid.Column="3"
                                   Text="{Binding Architecture}"
                                   VerticalAlignment="Center"
                                   Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
                    </Grid>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>
        
        <!-- Selected Package Actions -->
        <Border x:Name="ActionPanel" 
                Grid.Row="3" 
                Style="{StaticResource CardStyle}"
                Visibility="Collapsed"
                Margin="0,16,0,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                
                <StackPanel>
                    <TextBlock x:Name="SelectedName" FontSize="14" FontWeight="SemiBold"
                               Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}" />
                    <TextBlock x:Name="SelectedFamily" FontSize="12"
                               Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
                </StackPanel>
                
                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                    <Button x:Name="OpenLocationButton" Content="Open Location" 
                            Click="OpenLocation_Click" Padding="12,6" Margin="0,0,8,0" />
                    <Button x:Name="UninstallButton" Content="Uninstall" 
                            Click="Uninstall_Click" Padding="12,6"
                            Foreground="{StaticResource ErrorBrush}" />
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- Status -->
        <TextBlock x:Name="StatusText" Grid.Row="3" 
                   Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                   Margin="0,8,0,0" />
    </Grid>
</UserControl>
